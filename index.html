<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hike Together</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; }
        /* Centered emoji boxes for member profile */
        .emoji-box {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // ‚ö†Ô∏è REPLACE WITH YOUR FIREBASE CONFIG
    const firebaseConfig = {
  apiKey: "AIzaSyDS6292P80pBlZ-rMVOAEwHfFEGo9RDDrk",
  authDomain: "hike-together-app.firebaseapp.com",
  projectId: "hike-together-app",
  storageBucket: "hike-together-app.firebasestorage.app",
  messagingSenderId: "773950556723",
  appId: "1:773950556723:web:36b9faae2ec3ceaeaa7146",
  measurementId: "G-WXFDKVVEER"
};

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const { useState, useEffect } = React;

        const AVATARS = ['üë®', 'üë©', 'üë¶', 'üëß', 'üßí', 'üë∂', 'üßë', 'üë¥', 'üëµ', 'üê∂', 'üê±', 'üêª', 'ü¶ä', 'ü¶Å', 'üêØ', 'ü¶Ñ'];
        const COLORS = ['#4CAF50', '#2196F3', '#FF9800', '#E91E63', '#9C27B0', '#00BCD4', '#FF5722', '#795548'];

        const Mountain = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></svg>;
        const Award = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>;
        const Calendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const MapPin = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const Plus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;

        const BadgeModal = ({ badge, onClose }) => {
          if (!badge) return null;
          return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={onClose}>
              <div className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl" onClick={(e) => e.stopPropagation()}>
                <div className="text-center">
                  <div className="text-6xl mb-4">{badge.icon}</div>
                  <h3 className="text-2xl font-bold text-green-800 mb-2">{badge.name}</h3>
                  <p className="text-gray-600 mb-4">{badge.desc}</p>
                  {badge.requirement && <div className="bg-green-50 rounded-lg p-3 mb-4"><p className="text-sm font-semibold text-green-800">Requirement: {badge.requirement} {badge.type === 'count' ? 'hikes' : badge.type === 'distance' ? 'miles' : 'feet'}</p></div>}
                  {badge.earned && badge.count > 0 && <div className="bg-yellow-50 rounded-lg p-3 mb-4"><p className="text-sm font-semibold text-yellow-800">‚ú® Achieved {badge.count} times!</p></div>}
                  <button onClick={onClose} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg">Close</button>
                </div>
              </div>
            </div>
          );
        };

        // Updated BADGES - marking milestone badges
        const BADGES = [
          { id: 'first', name: 'First Steps', icon: 'ü•æ', type: 'count', requirement: 1, desc: 'Complete your first hike', milestone: true },
          { id: 'explorer', name: 'Explorer', icon: 'üó∫Ô∏è', type: 'count', requirement: 5, desc: 'Complete 5 hikes', milestone: true },
          { id: 'adventurer', name: 'Adventurer', icon: '‚õ∞Ô∏è', type: 'count', requirement: 10, desc: 'Complete 10 hikes', milestone: true },
          { id: 'trailblazer', name: 'Trailblazer', icon: 'üî•', type: 'count', requirement: 25, desc: 'Complete 25 hikes', milestone: true },
          { id: 'legend', name: 'Hiking Legend', icon: 'üëë', type: 'count', requirement: 50, desc: 'Complete 50 hikes', milestone: true },
          { id: 'century', name: 'Century Club', icon: 'üíØ', type: 'count', requirement: 100, desc: 'Complete 100 hikes', milestone: true },
          { id: 'distance10', name: 'First 10', icon: 'üèÉ', type: 'distance', requirement: 10, desc: 'Hike 10 total miles', milestone: true },
          { id: 'distance25', name: 'Quarter Century', icon: 'üö∂', type: 'distance', requirement: 25, desc: 'Hike 25 total miles', milestone: true },
          { id: 'distance50', name: 'Half Century', icon: 'ü•á', type: 'distance', requirement: 50, desc: 'Hike 50 total miles', milestone: true },
          { id: 'distance100', name: 'Centurion', icon: '‚≠ê', type: 'distance', requirement: 100, desc: 'Hike 100 total miles', milestone: true },
          { id: 'distance250', name: 'Ultra Hiker', icon: 'üí™', type: 'distance', requirement: 250, desc: 'Hike 250 total miles', milestone: true },
          { id: 'distance500', name: 'Marathon Master', icon: 'üèÜ', type: 'distance', requirement: 500, desc: 'Hike 500 total miles', milestone: true },
          { id: 'climber1k', name: 'Hill Climber', icon: 'üßó', type: 'elevation', requirement: 1000, desc: 'Climb 1,000 feet', milestone: true },
          { id: 'climber5k', name: 'Peak Climber', icon: 'üèîÔ∏è', type: 'elevation', requirement: 5000, desc: 'Climb 5,000 feet', milestone: true },
          { id: 'climber10k', name: 'Mountain Goat', icon: 'üêê', type: 'elevation', requirement: 10000, desc: 'Climb 10,000 feet', milestone: true },
          { id: 'climber25k', name: 'Everest Base', icon: 'üóª', type: 'elevation', requirement: 25000, desc: 'Climb 25,000 feet', milestone: true },
          { id: 'climber50k', name: 'Sky Walker', icon: '‚òÅÔ∏è', type: 'elevation', requirement: 50000, desc: 'Climb 50,000 feet', milestone: true },
          { id: 'climber100k', name: 'Altitude King', icon: 'üëë', type: 'elevation', requirement: 100000, desc: 'Climb 100,000 feet', milestone: true },
          { id: 'waterfall', name: 'Waterfall Finder', icon: 'üí¶', type: 'discovery', desc: 'Find a waterfall' },
          { id: 'wildlife', name: 'Wildlife Spotter', icon: 'ü¶å', type: 'discovery', desc: 'See a wild animal' },
          { id: 'bird', name: 'Bird Watcher', icon: 'ü¶Ö', type: 'discovery', desc: 'Spot a bird' },
          { id: 'butterfly', name: 'Butterfly Hunter', icon: 'ü¶ã', type: 'discovery', desc: 'See a butterfly' },
          { id: 'mushroom', name: 'Fungi Finder', icon: 'üçÑ', type: 'discovery', desc: 'Discover mushrooms' },
          { id: 'wildflower', name: 'Flower Power', icon: 'üå∏', type: 'discovery', desc: 'Find wildflowers' },
          { id: 'treeclimb', name: 'Tree Hugger', icon: 'üå≥', type: 'discovery', desc: 'Hug a big tree' },
          { id: 'pinecone', name: 'Pine Collector', icon: 'üå≤', type: 'discovery', desc: 'Collect a pinecone' },
          { id: 'rock', name: 'Rock Hound', icon: 'ü™®', type: 'discovery', desc: 'Find a cool rock' },
          { id: 'feather', name: 'Feather Finder', icon: 'ü™∂', type: 'discovery', desc: 'Find a feather' },
          { id: 'stream', name: 'Stream Crosser', icon: 'üåä', type: 'discovery', desc: 'Cross a stream' },
          { id: 'cave', name: 'Cave Explorer', icon: 'üï≥Ô∏è', type: 'discovery', desc: 'Explore a cave' },
          { id: 'bridge', name: 'Bridge Walker', icon: 'üåâ', type: 'discovery', desc: 'Cross a bridge' },
          { id: 'sunset', name: 'Sunset Chaser', icon: 'üåÖ', type: 'discovery', desc: 'Watch a sunset' },
          { id: 'sunrise', name: 'Early Bird', icon: 'üåÑ', type: 'discovery', desc: 'Watch a sunrise' },
          { id: 'rainbow', name: 'Rainbow Finder', icon: 'üåà', type: 'discovery', desc: 'See a rainbow' },
          { id: 'fog', name: 'Mist Walker', icon: 'üå´Ô∏è', type: 'discovery', desc: 'Hike in fog' },
          { id: 'snow', name: 'Snow Trekker', icon: '‚ùÑÔ∏è', type: 'discovery', desc: 'Hike in snow' },
          { id: 'rain', name: 'Rain Dancer', icon: 'üåßÔ∏è', type: 'discovery', desc: 'Hike in rain' },
          { id: 'frog', name: 'Frog Friend', icon: 'üê∏', type: 'discovery', desc: 'See a frog' },
          { id: 'squirrel', name: 'Squirrel Scout', icon: 'üêøÔ∏è', type: 'discovery', desc: 'Spot a squirrel' },
          { id: 'snake', name: 'Snake Seeker', icon: 'üêç', type: 'discovery', desc: 'See a snake' },
          { id: 'turtle', name: 'Turtle Tracker', icon: 'üê¢', type: 'discovery', desc: 'Find a turtle' },
          { id: 'rabbit', name: 'Bunny Buddy', icon: 'üê∞', type: 'discovery', desc: 'See a rabbit' },
          { id: 'fish', name: 'Fish Finder', icon: 'üêü', type: 'discovery', desc: 'Spot a fish' },
          { id: 'bee', name: 'Bee Buddy', icon: 'üêù', type: 'discovery', desc: 'See a bee' },
          { id: 'spider', name: 'Spider Spy', icon: 'üï∑Ô∏è', type: 'discovery', desc: 'Find a spider' },
          { id: 'acorn', name: 'Acorn Collector', icon: 'üå∞', type: 'discovery', desc: 'Find an acorn' },
          { id: 'leaf', name: 'Leaf Lover', icon: 'üçÇ', type: 'discovery', desc: 'Collect a special leaf' },
          { id: 'stick', name: 'Stick Collector', icon: 'ü™µ', type: 'discovery', desc: 'Find a hiking stick' },
          { id: 'tracks', name: 'Track Tracker', icon: 'üë£', type: 'discovery', desc: 'Find animal tracks' },
          { id: 'berries', name: 'Berry Scout', icon: 'ü´ê', type: 'discovery', desc: 'Find berries' },
          { id: 'nest', name: 'Nest Navigator', icon: 'ü™π', type: 'discovery', desc: 'Find a bird nest' },
          { id: 'fossil', name: 'Fossil Hunter', icon: 'ü¶¥', type: 'discovery', desc: 'Find a fossil' },
          { id: 'crystal', name: 'Crystal Seeker', icon: 'üíé', type: 'discovery', desc: 'Find a crystal/quartz' },
          { id: 'clouds', name: 'Cloud Watcher', icon: '‚òÅÔ∏è', type: 'discovery', desc: 'Watch interesting clouds' },
          { id: 'wind', name: 'Wind Rider', icon: 'üí®', type: 'discovery', desc: 'Feel strong wind' },
          { id: 'moon', name: 'Moon Gazer', icon: 'üåô', type: 'discovery', desc: 'See the moon on trail' },
          { id: 'summit', name: 'Summit Master', icon: 'üèîÔ∏è', type: 'location', desc: 'Reach a summit' },
          { id: 'forest', name: 'Forest Explorer', icon: 'üå≤', type: 'location', desc: 'Hike in forest' },
          { id: 'desert', name: 'Desert Walker', icon: 'üèúÔ∏è', type: 'location', desc: 'Hike in desert' },
          { id: 'beach', name: 'Beach Hiker', icon: 'üèñÔ∏è', type: 'location', desc: 'Walk on beach' },
          { id: 'canyon', name: 'Canyon Explorer', icon: 'üèûÔ∏è', type: 'location', desc: 'Hike a canyon' },
          { id: 'lake', name: 'Lake Lover', icon: 'üèûÔ∏è', type: 'location', desc: 'Visit a lake' },
          { id: 'river', name: 'River Runner', icon: 'üèûÔ∏è', type: 'location', desc: 'Follow a river' },
          { id: 'meadow', name: 'Meadow Walker', icon: 'üåæ', type: 'location', desc: 'Cross a meadow' },
          { id: 'ridge', name: 'Ridge Runner', icon: '‚õ∞Ô∏è', type: 'location', desc: 'Walk a ridge' },
          { id: 'valley', name: 'Valley Visitor', icon: 'üèîÔ∏è', type: 'location', desc: 'Explore a valley' },
          { id: 'park', name: 'Park Ranger', icon: 'üèïÔ∏è', type: 'location', desc: 'Visit a state/national park' },
          { id: 'urban', name: 'City Hiker', icon: 'üèôÔ∏è', type: 'location', desc: 'Urban trail walk' },
          { id: 'night', name: 'Night Owl', icon: 'ü¶â', type: 'special', desc: 'Night hike' },
          { id: 'winter', name: 'Winter Warrior', icon: '‚õÑ', type: 'special', desc: 'Winter hike' },
          { id: 'spring', name: 'Spring Walker', icon: 'üå∑', type: 'special', desc: 'Spring hike' },
          { id: 'summer', name: 'Summer Trekker', icon: '‚òÄÔ∏è', type: 'special', desc: 'Summer hike' },
          { id: 'fall', name: 'Fall Wanderer', icon: 'üçÅ', type: 'special', desc: 'Fall hike' },
          { id: 'solo', name: 'Solo Adventurer', icon: 'üö∂', type: 'special', desc: 'Solo hike' },
          { id: 'group', name: 'Group Leader', icon: 'üë•', type: 'special', desc: 'Group hike (4+)' },
          { id: 'picnic', name: 'Picnic Pro', icon: 'üß∫', type: 'special', desc: 'Trail picnic' },
          { id: 'backpack', name: 'Backpacker', icon: 'üéí', type: 'special', desc: 'Overnight backpack' },
          { id: 'campfire', name: 'Campfire King', icon: 'üî•', type: 'special', desc: 'Make a campfire' },
          { id: 'tent', name: 'Tent Master', icon: '‚õ∫', type: 'special', desc: 'Sleep in a tent' },
          { id: 'geocache', name: 'Geocacher', icon: 'üìç', type: 'special', desc: 'Find a geocache' },
          { id: 'photo', name: 'Photographer', icon: 'üì∑', type: 'special', desc: 'Take great photos' },
          { id: 'journal', name: 'Trail Journalist', icon: 'üìì', type: 'special', desc: 'Journal on trail' },
          { id: 'sketch', name: 'Nature Artist', icon: 'üé®', type: 'special', desc: 'Draw/sketch on trail' }
        ];

        function App() {
          const [user, setUser] = useState(null);
          const [loading, setLoading] = useState(true);
          const [family, setFamily] = useState([]);
          const [hikes, setHikes] = useState([]);
          const [selectedMember, setSelectedMember] = useState(null);
          const [showForm, setShowForm] = useState(false);
          const [selectedBadge, setSelectedBadge] = useState(null);
          const [formData, setFormData] = useState({ 
            name: '', 
            date: new Date().toISOString().split('T')[0], 
            distance: '', 
            elevation: '', 
            difficulty: 'easy', // NEW: default difficulty
            location: '', 
            notes: '', 
            activities: [] 
          });

          useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(user => {
              setUser(user);
              setLoading(false);
            });
            return unsubscribe;
          }, []);

          useEffect(() => {
            if (user) {
              const familyRef = db.collection('families').doc(user.uid).collection('members');
              const unsubscribeFamily = familyRef.onSnapshot(snapshot => {
                const members = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setFamily(members);
                if (!selectedMember && members.length > 0) {
                  setSelectedMember(members[0]);
                }
              });

              const hikesRef = db.collection('families').doc(user.uid).collection('hikes');
              const unsubscribeHikes = hikesRef.orderBy('date', 'desc').onSnapshot(snapshot => {
                const hikesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setHikes(hikesData);
              });

              return () => {
                unsubscribeFamily();
                unsubscribeHikes();
              };
            }
          }, [user]);

          const signIn = async () => {
            try {
              await auth.signInAnonymously();
            } catch (error) {
              console.error('Sign in error:', error);
            }
          };

          const addMember = async (name, avatar, color) => {
            if (!user || !name.trim()) return;
            try {
              await db.collection('families').doc(user.uid).collection('members').add({
                name: name.trim(),
                avatar,
                color,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });
            } catch (error) {
              console.error('Add member error:', error);
            }
          };

          const saveHike = async () => {
            if (!user || !selectedMember || !formData.name || !formData.distance || !formData.difficulty) {
              alert('Please fill in all required fields (name, distance, difficulty)!');
              return;
            }

            try {
              await db.collection('families').doc(user.uid).collection('hikes').add({
                name: formData.name,
                date: formData.date,
                distance: parseFloat(formData.distance),
                elevation: parseInt(formData.elevation) || 0,
                difficulty: formData.difficulty, // NEW: save difficulty
                location: formData.location,
                notes: formData.notes,
                activities: formData.activities,
                hikerId: selectedMember.id,
                hikerName: selectedMember.name,
                hikerAvatar: selectedMember.avatar,
                hikerColor: selectedMember.color,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
              });

              setFormData({ 
                name: '', 
                date: new Date().toISOString().split('T')[0], 
                distance: '', 
                elevation: '', 
                difficulty: 'easy', // NEW: reset difficulty
                location: '', 
                notes: '', 
                activities: [] 
              });
              setShowForm(false);
            } catch (error) {
              console.error('Save hike error:', error);
            }
          };

          const deleteHike = async (id) => {
            if (window.confirm('Delete this hike?')) {
              try {
                await db.collection('families').doc(user.uid).collection('hikes').doc(id).delete();
              } catch (error) {
                console.error('Delete error:', error);
              }
            }
          };

          const toggleActivity = (activityId) => {
            setFormData(prev => ({
              ...prev,
              activities: prev.activities.includes(activityId)
                ? prev.activities.filter(id => id !== activityId)
                : [...prev.activities, activityId]
            }));
          };

          if (loading) {
            return <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-100 to-blue-100"><div className="text-2xl font-bold text-green-700">Loading...</div></div>;
          }

          if (!user) {
            return (
              <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-100 to-blue-100 p-4">
                <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
                  <div className="text-6xl mb-4">ü•æ</div>
                  <h1 className="text-4xl font-bold text-green-700 mb-4">Hike Together</h1>
                  <p className="text-gray-600 mb-8">Track your family's hiking adventures</p>
                  <button onClick={signIn} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg">Get Started</button>
                </div>
              </div>
            );
          }

          const memberHikes = hikes.filter(h => h.hikerId === selectedMember?.id);
          
          // Calculate stats for selected member
          const stats = {
            totalHikes: memberHikes.length,
            totalDistance: memberHikes.reduce((sum, h) => sum + (h.distance || 0), 0),
            totalElevation: memberHikes.reduce((sum, h) => sum + (h.elevation || 0), 0),
            longestHike: memberHikes.length > 0 ? Math.max(...memberHikes.map(h => h.distance || 0)) : 0, // NEW
            highestElevation: memberHikes.length > 0 ? Math.max(...memberHikes.map(h => h.elevation || 0)) : 0 // NEW
          };

          // Calculate milestone badge progress (cumulative, not repeatable)
          const milestoneBadges = BADGES.filter(b => b.milestone).map(badge => {
            let progress = 0;
            let earned = false;
            
            if (badge.type === 'count') {
              progress = stats.totalHikes;
              earned = progress >= badge.requirement;
            } else if (badge.type === 'distance') {
              progress = stats.totalDistance;
              earned = progress >= badge.requirement;
            } else if (badge.type === 'elevation') {
              progress = stats.totalElevation;
              earned = progress >= badge.requirement;
            }
            
            return { ...badge, progress, earned };
          });

          // Calculate discovery/repeatable badges (can be earned multiple times)
          const earnedActivities = {};
          memberHikes.forEach(hike => {
            if (hike.activities) {
              hike.activities.forEach(actId => {
                earnedActivities[actId] = (earnedActivities[actId] || 0) + 1;
              });
            }
          });

          const discoverableBadges = BADGES.filter(b => !b.milestone).map(badge => ({
            ...badge,
            count: earnedActivities[badge.id] || 0,
            earned: (earnedActivities[badge.id] || 0) > 0
          }));

          const selectableActivities = BADGES.filter(b => !b.milestone);

          return (
            <div className="min-h-screen bg-gradient-to-br from-green-100 to-blue-100">
              <div className="max-w-7xl mx-auto p-4">
                <header className="text-center py-6">
                  <h1 className="text-5xl font-bold text-green-700 mb-2">ü•æ Hike Together</h1>
                  <p className="text-gray-600">Track your family's hiking adventures</p>
                </header>

                {family.length === 0 ? (
                  <div className="bg-white rounded-3xl shadow-xl p-8 max-w-2xl mx-auto">
                    <h2 className="text-3xl font-bold text-green-800 mb-6 text-center">Create Your Family</h2>
                    <div className="space-y-6">
                      {[1, 2, 3, 4].map((n) => (
                        <div key={n} className="border-2 border-green-200 rounded-xl p-4">
                          <h3 className="font-semibold text-green-800 mb-3">Member {n}</h3>
                          <div className="flex gap-4">
                            <input type="text" id={`name-${n}`} placeholder="Name" className="flex-1 p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                            <select id={`avatar-${n}`} className="p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none emoji-box">
                              {AVATARS.map(a => <option key={a} value={a}>{a}</option>)}
                            </select>
                            <select id={`color-${n}`} className="p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" style={{width: '80px'}}>
                              {COLORS.map(c => <option key={c} value={c} style={{backgroundColor: c, color: 'white'}}>‚óè</option>)}
                            </select>
                            <button onClick={() => {
                              const name = document.getElementById(`name-${n}`).value;
                              const avatar = document.getElementById(`avatar-${n}`).value;
                              const color = document.getElementById(`color-${n}`).value;
                              if (name) {
                                addMember(name, avatar, color);
                                document.getElementById(`name-${n}`).value = '';
                              }
                            }} className="bg-green-600 hover:bg-green-700 text-white px-6 rounded-lg font-bold">Add</button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="lg:col-span-1 space-y-4">
                      <div className="bg-white rounded-2xl shadow-xl p-6">
                        <h2 className="text-2xl font-bold text-green-800 mb-4">Family</h2>
                        <div className="space-y-3">
                          {family.map(member => (
                            <button key={member.id} onClick={() => setSelectedMember(member)} className={`w-full text-left p-4 rounded-xl border-2 ${selectedMember?.id === member.id ? 'border-green-500 bg-green-50' : 'border-gray-200 hover:border-green-300'}`}>
                              <div className="flex items-center gap-3">
                                <div className="text-4xl emoji-box" style={{backgroundColor: member.color, width: '60px', height: '60px', borderRadius: '12px'}}>{member.avatar}</div>
                                <div className="font-bold text-lg">{member.name}</div>
                              </div>
                            </button>
                          ))}
                        </div>
                      </div>

                      {selectedMember && (
                        <div className="bg-white rounded-2xl shadow-xl p-6">
                          <h2 className="text-2xl font-bold text-green-800 mb-4">Stats</h2>
                          <div className="space-y-3">
                            <div className="bg-gradient-to-r from-green-400 to-green-600 text-white p-4 rounded-lg">
                              <div className="text-3xl font-bold">{stats.totalHikes}</div>
                              <div className="text-sm opacity-90">Total Hikes</div>
                            </div>
                            <div className="bg-gradient-to-r from-blue-400 to-blue-600 text-white p-4 rounded-lg">
                              <div className="text-3xl font-bold">{stats.totalDistance.toFixed(1)}</div>
                              <div className="text-sm opacity-90">Miles Hiked</div>
                            </div>
                            <div className="bg-gradient-to-r from-purple-400 to-purple-600 text-white p-4 rounded-lg">
                              <div className="text-3xl font-bold">{stats.totalElevation.toLocaleString()}</div>
                              <div className="text-sm opacity-90">Elevation Gain (ft)</div>
                            </div>
                            {/* NEW: Longest Hike */}
                            <div className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-lg">
                              <div className="text-3xl font-bold">{stats.longestHike.toFixed(1)}</div>
                              <div className="text-sm opacity-90">Longest Hike (mi)</div>
                            </div>
                            {/* NEW: Highest Elevation */}
                            <div className="bg-gradient-to-r from-red-400 to-pink-600 text-white p-4 rounded-lg">
                              <div className="text-3xl font-bold">{stats.highestElevation.toLocaleString()}</div>
                              <div className="text-sm opacity-90">Highest Elevation (ft)</div>
                            </div>
                          </div>
                        </div>
                      )}

                      {selectedMember && (
                        <div className="bg-white rounded-2xl shadow-xl p-6">
                          <h2 className="text-2xl font-bold text-green-800 mb-4">Badges</h2>
                          
                          {/* Milestone Badges Section */}
                          <div className="mb-6">
                            <h3 className="text-lg font-bold text-gray-700 mb-3">üèîÔ∏è Milestone Progress</h3>
                            <p className="text-xs text-gray-600 mb-3">Cumulative achievements that track your total progress</p>
                            <div className="grid grid-cols-4 gap-2 mb-4">
                              {milestoneBadges.slice(0, 8).map(badge => (
                                <button key={badge.id} onClick={() => setSelectedBadge(badge)} className={`p-2 rounded-lg text-center ${badge.earned ? 'bg-yellow-100 border-2 border-yellow-400' : 'bg-gray-100 border-2 border-gray-300 opacity-50'}`} title={badge.name}>
                                  <div className="text-2xl mb-1">{badge.icon}</div>
                                  {badge.earned && <div className="text-xs font-bold text-yellow-600">‚úì</div>}
                                  {!badge.earned && (
                                    <div className="text-xs text-gray-600">
                                      {badge.type === 'count' && `${stats.totalHikes}/${badge.requirement}`}
                                      {badge.type === 'distance' && `${stats.totalDistance.toFixed(0)}/${badge.requirement}`}
                                      {badge.type === 'elevation' && `${Math.floor(stats.totalElevation)}/${badge.requirement}`}
                                    </div>
                                  )}
                                </button>
                              ))}
                            </div>
                          </div>

                          {/* Discoverable Badges Section */}
                          <div>
                            <h3 className="text-lg font-bold text-gray-700 mb-3">üéØ Discovery Badges</h3>
                            <p className="text-xs text-gray-600 mb-3">Repeatable achievements you can earn multiple times</p>
                            <div className="grid grid-cols-4 gap-2">
                              {discoverableBadges.slice(0, 12).map(badge => (
                                <button key={badge.id} onClick={() => setSelectedBadge(badge)} className={`p-2 rounded-lg text-center ${badge.earned ? 'bg-green-100 border-2 border-green-400' : 'bg-gray-100 border-2 border-gray-300 opacity-50'}`} title={badge.name}>
                                  <div className="text-2xl mb-1">{badge.icon}</div>
                                  {badge.count > 0 && <div className="text-xs font-bold text-green-600">{badge.count}√ó</div>}
                                </button>
                              ))}
                            </div>
                            {discoverableBadges.filter(b => b.earned).length > 12 && (
                              <p className="text-xs text-gray-500 mt-2 text-center">+{discoverableBadges.filter(b => b.earned).length - 12} more earned</p>
                            )}
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="lg:col-span-2">
                      {!showForm && (
                        <button onClick={() => setShowForm(true)} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-2xl shadow-lg mb-6 flex items-center justify-center gap-2">
                          <Plus /> Add New Hike
                        </button>
                      )}

                      {showForm && (
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                          <h2 className="text-2xl font-bold text-green-800 mb-4">New Hike for {selectedMember?.name}</h2>
                          <div className="space-y-4">
                            <input type="text" placeholder="Trail Name *" value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                            <input type="date" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                            
                            {/* NEW: Difficulty Selector */}
                            <div>
                              <label className="block text-sm font-semibold text-gray-700 mb-2">Difficulty *</label>
                              <select value={formData.difficulty} onChange={(e) => setFormData({...formData, difficulty: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none">
                                <option value="easy">Easy üü¢</option>
                                <option value="medium">Medium üü°</option>
                                <option value="hard">Hard üî¥</option>
                              </select>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                              <input type="number" step="0.1" placeholder="Distance (miles) *" value={formData.distance} onChange={(e) => setFormData({...formData, distance: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                              <input type="number" placeholder="Elevation (feet)" value={formData.elevation} onChange={(e) => setFormData({...formData, elevation: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                            </div>
                            <input type="text" placeholder="Location" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none" />
                            <textarea placeholder="Notes" value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} className="w-full p-3 border-2 border-green-200 rounded-lg focus:border-green-500 outline-none h-24" />
                            <div className="border-2 border-green-200 rounded-lg p-4">
                              <h3 className="font-semibold text-green-800 mb-2">üèÜ What did you do/see?</h3>
                              {[
                                {title:'Wildlife & Creatures',ids:['wildlife','bird','butterfly','frog','squirrel','snake','turtle','rabbit','fish','bee','spider']},
                                {title:'Nature & Scenery',ids:['waterfall','mushroom','wildflower','treeclimb','pinecone','rock','feather','stream','cave','bridge','sunset','sunrise','rainbow','fog','snow','rain','acorn','leaf','stick','tracks','berries','nest','fossil','crystal','clouds','wind','moon']},
                                {title:'Locations',type:'location'},
                                {title:'Activities',type:'special'}
                              ].map(section => (
                                <div key={section.title} className="mb-4">
                                  <h4 className="text-xs font-semibold text-gray-600 mb-2">{section.title}</h4>
                                  <div className="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2">
                                    {selectableActivities.filter(b => section.type ? b.type === section.type : section.ids.includes(b.id)).map(badge => {
                                      const selected = formData.activities.includes(badge.id);
                                      return (
                                        <button key={badge.id} type="button" onClick={() => toggleActivity(badge.id)} className={`p-2 rounded-lg border-2 ${selected ? 'bg-yellow-50 border-yellow-400 scale-105' : 'bg-white border-gray-200'}`} title={badge.desc}>
                                          <div className="text-2xl mb-1">{badge.icon}</div>
                                          <div className="text-xs font-medium leading-tight" style={{minHeight:'2rem'}}>{badge.name}</div>
                                        </button>
                                      );
                                    })}
                                  </div>
                                </div>
                              ))}
                            </div>
                            <div className="flex gap-2">
                              <button onClick={saveHike} className="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg">Save</button>
                              <button onClick={() => setShowForm(false)} className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 rounded-lg">Cancel</button>
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="space-y-4">
                        <h2 className="text-2xl font-bold text-green-800">Your Hikes</h2>
                        {memberHikes.length === 0 ? (
                          <div className="bg-white rounded-lg shadow-md p-8 text-center text-gray-500">
                            <Mountain className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                            <p className="text-xl">No hikes yet!</p>
                          </div>
                        ) : (
                          memberHikes.map(hike => {
                            // NEW: Difficulty badge display
                            const difficultyColors = {
                              easy: 'bg-green-100 text-green-800 border-green-400',
                              medium: 'bg-yellow-100 text-yellow-800 border-yellow-400',
                              hard: 'bg-red-100 text-red-800 border-red-400'
                            };
                            const difficultyIcons = {
                              easy: 'üü¢',
                              medium: 'üü°',
                              hard: 'üî¥'
                            };

                            return (
                              <div key={hike.id} className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex justify-between items-start mb-3">
                                  <div>
                                    <div className="flex items-center gap-2 mb-1">
                                      <span className="text-2xl">{hike.hikerAvatar}</span>
                                      <h3 className="text-xl font-bold text-green-800">{hike.name}</h3>
                                      {/* NEW: Show difficulty badge */}
                                      {hike.difficulty && (
                                        <span className={`px-2 py-1 rounded-full text-xs font-bold border-2 ${difficultyColors[hike.difficulty] || 'bg-gray-100 text-gray-800'}`}>
                                          {difficultyIcons[hike.difficulty] || '‚ö™'} {hike.difficulty.charAt(0).toUpperCase() + hike.difficulty.slice(1)}
                                        </span>
                                      )}
                                    </div>
                                    <div className="flex items-center gap-4 text-gray-600 text-sm">
                                      <span className="flex items-center gap-1"><Calendar />{new Date(hike.date).toLocaleDateString()}</span>
                                      {hike.location && <span className="flex items-center gap-1"><MapPin />{hike.location}</span>}
                                    </div>
                                  </div>
                                  <button onClick={() => deleteHike(hike.id)} className="text-red-500 hover:text-red-700 text-sm">Delete</button>
                                </div>
                                <div className="flex gap-4 mb-3">
                                  <div className="bg-blue-50 px-4 py-2 rounded-lg">
                                    <div className="text-blue-800 font-bold">{hike.distance} mi</div>
                                    <div className="text-blue-600 text-sm">Distance</div>
                                  </div>
                                  {hike.elevation > 0 && (
                                    <div className="bg-purple-50 px-4 py-2 rounded-lg">
                                      <div className="text-purple-800 font-bold">{hike.elevation} ft</div>
                                      <div className="text-purple-600 text-sm">Elevation</div>
                                    </div>
                                  )}
                                </div>
                                {hike.notes && <p className="text-gray-700 bg-gray-50 p-3 rounded-lg mb-3">{hike.notes}</p>}
                                {hike.activities && hike.activities.length > 0 && (
                                  <div className="mt-3">
                                    <div className="text-sm font-semibold text-gray-700 mb-2">Badges Earned:</div>
                                    <div className="flex flex-wrap gap-2">
                                      {hike.activities.map(activityId => {
                                        const badge = BADGES.find(b => b.id === activityId);
                                        return badge ? (
                                          <div key={activityId} className="bg-yellow-50 border-2 border-yellow-400 rounded-lg px-3 py-1 flex items-center gap-2">
                                            <span className="text-xl">{badge.icon}</span>
                                            <span className="text-sm font-medium">{badge.name}</span>
                                          </div>
                                        ) : null;
                                      })}
                                    </div>
                                  </div>
                                )}
                              </div>
                            );
                          })
                        )}
                      </div>
                    </div>
                  </div>
                )}
              </div>
              <BadgeModal badge={selectedBadge} onClose={() => setSelectedBadge(null)} />
            </div>
          );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
